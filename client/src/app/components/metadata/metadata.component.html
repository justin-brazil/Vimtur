<div class="container pad-bottom" *ngIf="media; else loading">
  <h4>Metadata</h4>
  <div class="header">
    <img
      class="img-fluid img-thumbnail thumbnail"
      [src]="'/cache/thumbnails/' + media.hash + '.png'"
    />
    <div class="media-path">
      <div>Path: {{ media.path }}</div>
      <div>Hash: {{ media.hash }}</div>
      <div *ngIf="media.metadata">
        Resolution: {{ media.metadata.width }}x{{ media.metadata.height }}
      </div>
    </div>
  </div>

  <div class="card form-card">
    <h5 class="form-padded-input">Artist</h5>
    <div class="row">
      <input
        [(ngModel)]="mediaModel.metadata.artist"
        class="form-control"
        type="text"
        [placeholder]="media.metadata.artist || ''"
      />
    </div>

    <h5 class="form-padded-input">Album</h5>
    <div class="row">
      <input
        [(ngModel)]="mediaModel.metadata.album"
        class="form-control"
        type="text"
        [placeholder]="media.metadata.album || ''"
      />
    </div>

    <h5 class="form-padded-input">Title</h5>
    <div class="row">
      <input
        [(ngModel)]="mediaModel.metadata.title"
        class="form-control"
        type="text"
        [placeholder]="media.metadata.title || ''"
      />
    </div>

    <div class="row">
      <button
        class="btn btn-primary btn-block form-padded-input"
        (click)="mediaService.saveMetadata(mediaModel.metadata)"
      >
        Save
      </button>
    </div>
  </div>

  <div class="card form-card">
    <h5 class="form-padded-input">Rating</h5>
    <div class="row">
      <ngb-rating
        [starTemplate]="ratingStar"
        [(rate)]="mediaModel.rating"
        (rateChange)="mediaService.setRating(mediaModel.rating)"
        max="5"
        [tabindex]="-1"
        #ratingElement
      ></ngb-rating>
    </div>

    <h5 class="form-padded-input">Tags</h5>
    <div class="row">
      <angular2-multiselect
        *ngIf="mediaModel.tags"
        [data]="tags"
        [settings]="{
          text: '+ Tag',
          enableCheckAll: false,
          enableSearchFilter: true,
          addNewItemOnFilter: true,
          enableFilterSelectAll: true
        }"
        [ngModel]="mediaModel.tags"
        (onAddFilterNewItem)="tagService.addTag($event)"
        (onSelect)="mediaService.addTag($event.id)"
        (onDeSelect)="mediaService.removeTag($event.id)"
      >
      </angular2-multiselect>
    </div>

    <h5 class="form-padded-input">Actors</h5>
    <div class="row">
      <angular2-multiselect
        *ngIf="mediaModel.actors"
        [data]="actors"
        [settings]="{
          text: '+ Actor',
          enableCheckAll: false,
          enableSearchFilter: true,
          addNewItemOnFilter: true,
          enableFilterSelectAll: true
        }"
        [ngModel]="mediaModel.actors"
        (onAddFilterNewItem)="actorService.addActor($event)"
        (onSelect)="mediaService.addActor($event.id)"
        (onDeSelect)="mediaService.removeActor($event.id)"
      >
      </angular2-multiselect>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="loading">
    Loading media
    <ngb-progressbar type="info" [value]="100" [striped]="true" [animated]="true"></ngb-progressbar>
  </div>
</ng-template>

<ng-template #ratingStar let-fill="fill">
  <span class="star">
    <span class="half" [style.width.%]="fill">&#9733;</span>{{ fill ? '&#9733;' : '&#9734;' }}
  </span>
</ng-template>
